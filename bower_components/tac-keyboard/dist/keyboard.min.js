(function(){"use strict";angular.module("module.tac.keyboard",["angularLocalStorage","module.tac.navigable","module.tac.svg"]).factory("tac.keyboard",["$modal","tac.keys","storage",function(a,b,c){var d,e,f,g,h,i;return d="assets/tac_components",i="tac.keyboard.last",f={t9:{key:"t9",windowClass:"t9-dialog",templateUrl:"t9.html",controller:"tac.keyboard.t9"},qwerty:{key:"qwerty",windowClass:"qwerty-dialog",templateUrl:"qwerty.html",controller:"tac.keyboard.qwerty"}},g=f.qwerty,function(){var a;return(a=c.get(i))&&(g=f[a]||g)}(),h=function(b,d){var e;return b!==g&&(g=b,c.set(i,b.key)),e=a.open({windowClass:b.windowClass,templateUrl:b.templateUrl,controller:b.controller,resolve:{container:function(){return d}}}),d.modal=e,e.result.then(d.edition.success,d.edition.close)},e={set_assets_path:function(a){return d=a},edit:function(a){var c,e,i,j;return b.create_level(),e=[],i=[],j=function(){var a,d;return d={},a=function(){var a;return a={close:function(){var c,d,e,f;if(!a.cancelled){for(b.previous_level(),f=[],d=0,e=i.length;e>d;d++)c=i[d],f.push(c());return f}},success:function(){var d,f,g,h,j,k;if(!a.cancelled){for(b.previous_level(),f=0,h=e.length;h>f;f++)(d=e[f])(c.text);for(k=[],g=0,j=i.length;j>g;g++)d=i[g],k.push(d());return k}}}},{generate:function(){return d.cancelled=!0,d=a()}}}(),c={set_modal:function(a){return c.modal=a,this},edition:j.generate(),assets:d,text:a,to_t9:function(){return c.edition=j.generate(),c.modal.opened.then(function(){return c.modal.close(),h(f.t9,c)})},to_qwerty:function(){return c.edition=j.generate(),c.modal.opened.then(function(){}),c.modal.close(),h(f.qwerty,c)}},h(g,c),{done:function(a){return e.push(a)},exit:function(a){return i.push(a)}}}}}])}).call(this),function(){"use strict";angular.module("module.tac.keyboard").factory("tac.keyboard.content",[function(){var a,b;return a=function(a){var b,c,d,e,f;for(d=[],b=e=0,f=a.length;f>e;b=++e)c=a[b],d.push({key:c,index:b});return d},b=function(b){var c;return c=b.content={},c.erase=function(){return c.before="",c.after="",c.sanitize()},c.write=function(a){return c.before+=a,c.sanitize()},c.remove_one=function(){return c.before=c.before.substring(0,c.before.length-1),c.sanitize()},c.rewrite=function(a){return c.before=c.before.substring(0,c.before.length-1)+a,c.sanitize()},c.init=function(){return c.before=b.text,c.after="",c.sanitize()},c.left=function(){var a;return this.before.length>0?(a=this.before.charAt(this.before.length-1),this.after=a+this.after,this.before=this.before.substring(0,this.before.length-1),this.sanitize(),!0):void 0},c.right=function(){var a;return this.after.length>0?(a=this.after.charAt(0),this.before+=a,this.after=this.after.substring(1,this.after.length),this.sanitize(),!0):void 0},c.sanitize=function(){return b.text=c.before+c.after,c.before_letters=a(c.before),c.after_letters=a(c.after)}},{process:function(a){return a.content||b(a),a.content.init()}}}])}.call(this),function(){"use strict";angular.module("module.tac.keyboard").directive("keyboardInput",[function(){var a,b;return b=60,a=function(a,c){var d,e,f,g;return d=function(){},e=c[0].offsetLeft,g=a[0].scrollLeft+a[0].clientWidth,f=a[0].scrollLeft,e>g-b&&a.scrollLeft(c[0].offsetLeft-a[0].clientWidth+b),f+b>e?a.scrollLeft(c[0].offsetLeft-b):void 0},{restrict:"A",link:function(b,c,d){var e;return e=c.find("#cursor"),b.$watch(function(){return a(c,e)})}}}])}.call(this),function(){"use strict";angular.module("module.tac.keyboard").controller("tac.keyboard.qwerty",["$scope","$modalInstance","tac.keys","tac.navigable.root","tac.navigable.component","tac.keyboard.qwerty.symbols","tac.keyboard.content","container",function(a,b,c,d,e,f,g,h){var i,j,k,l;return a.assets=h.assets,k={real_alt:!1,real_acute:!1,real_shift:!1,real_caps_lock:!1,virtual_shift:!1,virtual_caps_lock:!1,last_virtual_shift:0,relapse_delay:800,sanitize:function(){return(this.real_caps_lock?!this.virtual_caps_lock:this.virtual_caps_lock)?a.has_shift=a.caps_lock=!0:a.has_shift=a.caps_lock=this.virtual_caps_lock=this.real_caps_lock=!1,(this.virtual_shift||this.real_shift)&&(a.has_shift=!a.has_shift),this.real_acute=!1}},g.process(h),l=d("modal-keyboard-root"),b.result["finally"](function(){return c.unsubscribe(l)}),c.subscribe(l),a.navigable=e.vertical("modal-keyboard-main").set_priority(2).bind_to(a,!0),a.navigable.handlers.go_back=function(a,c){return b.dismiss(),!0},a.navigable.handlers.unknow=function(b,c){var d;return d=k.real_shift?f.special.shift[b.value]:f.special[b.value],d&&i(d),a.$apply()},a.navigable.handlers.letter=function(b,c){return j(b.letter),a.$apply()},a.navigable.handlers.number=function(b,c){var d;return k.real_alt?(d=f.alt[b.number])&&i(d):k.real_shift?(d=f.shift[b.number])&&i(d):i(b.number),a.$apply()},a.navigable.handlers.space_bar=function(b,c){return j(" "),a.$apply()},a.navigable.handlers.alt_gr=function(a,b){return k.real_alt=!a.disable},a.navigable.handlers.acute=function(a,b){return k.real_acute=!0},a.navigable.handlers["delete"]=function(b,c){return h.content.remove_one(),a.$apply()},a.navigable.handlers.shift=function(b,c){return k.real_shift=!b.disable,k.virtual_shift=!1,k.sanitize(),a.$apply()},a.navigable.handlers.caps_lock=function(b,c){return k.real_caps_lock=!k.real_caps_lock,k.sanitize(),a.$apply()},a.container=h,a.set_active=function(a){return console.log(a)},i=function(b){return h.content.write(b),a.has_simbol=!1,k.virtual_shift&&(k.virtual_shift=!1),k.sanitize()},j=function(b){return k.real_acute&&(b=f.acute[b]||b),i(a.has_shift?b.toUpperCase():b)},a.tap_alphabetic=function(a){return j(a.content)},a.tap_special=function(b){return i(a.has_simbol?b.special:b.content)},a.tap_space=function(){return i(" ")},a.shift=function(){var a;return a=k.last_virtual_shift,k.last_virtual_shift=(new Date).getTime(),k.last_virtual_shift-a<k.relapse_delay?(k.virtual_caps_lock=!k.virtual_caps_lock,k.virtual_shift=!1):k.virtual_shift=!k.virtual_shift,k.sanitize()},a.simbol=function(){return a.has_simbol?a.has_simbol=!1:a.has_simbol=!0},l.add(a.navigable),a.resume=function(){return b.dismiss()},a.confirm=function(){return b.close()}}]).controller("tac.keyboard.qwerty.letters",["$scope","tac.navigable.component","tac.keyboard.qwerty.buttons",function(a,b,c){return a.navigable=b.multiline("modal-letters-frame",10).set_priority(1).bind_to(a),a.buttons=c}]).controller("tac.keyboard.qwerty.input",["$scope","tac.navigable.component",function(a,b){return a.navigable.handlers.left=function(){var b;return b=a.container.content.left(),b&&a.$apply(),b},a.navigable.handlers.right=function(){var b;return b=a.container.content.right(),b&&a.$apply(),b}}]).constant("tac.keyboard.qwerty.symbols",{acute:{a:"á",e:"é",i:"í",o:"ó",u:"ú"},alt:{2:"@"},shift:{1:"!",3:"#",4:"$",8:"(",9:")"},special:{188:",",189:"-",190:".",192:"ñ",shift:{188:";",189:"_",190:":",192:"Ñ"}}}).factory("tac.keyboard.qwerty.buttons",["tac.keyboard.qwerty.symbols",function(a){var b,c,d,e,f,g,h,i,j;return b="alphabetic",d="special",c="simple",j='!"@$%&*()=',e="qwertyuiopasdfghjklñzxcvbnm",h=",.?",i=";:¿",f=[],g=function(a,b){var c,d,e,g,h,i;for(i=[],e=g=0,h=a.length-1;h>=0?h>=g:g>=h;e=h>=0?++g:--g)d=a.charAt(e),c=b(d,e),i.push(f.push(c));return i},g(j,function(a,b){return{content:String(b),template:d,special:a}}),g(e,function(c,d){return{content:c,template:b,special:a.acute[c]||c}}),g(h,function(a,b){return{content:a,template:c,special:i.charAt(b)}}),f}])}.call(this),angular.module("module.tac.keyboard").run(["$templateCache",function(a){"use strict";a.put("qwerty.alphabetic.html",'<a class="button alphabetic" \n  ng-click="tap_alphabetic(button)"\n  navigable-leaf="button alphabetic"\n  href>\n  <div ng-hide="has_shift || has_simbol">\n    {{button.content}}\n  </div>\n  <div ng-show="has_shift && !has_simbol">\n    {{button.content.toUpperCase()}}\n  </div>\n  <div ng-show="!has_shift && has_simbol">\n    {{button.special}}\n  </div>\n  <div ng-show="has_shift && has_simbol">\n    {{button.special.toUpperCase()}}\n  </div>\n</a>'),a.put("qwerty.html",'<div>\n  <div class="modal-body" \n    navigable-vertical="qwerty modal body"\n    navigable-priority="0"\n    >\n    <div class="main-frame" >\n      <div class="input-frame"\n        ng-controller="tac.keyboard.qwerty.input"\n        keyboard-input id="input-frame"\n        navigable-leaf="input-frame"\n        navigable-priority="0"\n        >\n        <div class="input" >\n          <span ng-repeat="letter in container.content.before_letters"><span class="space" ng-if="letter.key==\' \'">_</span><span ng-if="letter.key!=\' \'">{{letter.key}}</span></span>\n        </div>\n        <div class="cursor" id="cursor"></div>\n        <div class="input">\n          <span ng-repeat="letter in container.content.after_letters"><span class="space" ng-if="letter.key==\' \'">_</span><span ng-if="letter.key!=\' \'">{{letter.key}}</span></span>\n        </div>\n      </div>\n      <div class="letters-frame" \n        ng-controller="tac.keyboard.qwerty.letters"\n        >\n        <div ng-repeat="button in buttons">\n          <div ng-include="\'qwerty.\' + button.template +\'.html\'" ></div>\n        </div>\n      </div>\n      <div class="actions-frame" \n        navigable-horizontal="actions frame"\n        navigable-priority="2"\n        >\n        <a class="button shift" \n          ng-click="$parent.shift()"\n          navigable-leaf="shift-button"\n          navigable-priority="0"\n          href>\n          <div class="caps-lock-container">\n            <div ng-show="caps_lock" class="caps-lock">\n            </div>\n          </div>\n          <svg class="shift-icon" inline-svg-model="{{assets}}/qwerty/shift.svg"></svg>\n        </a>\n        <a class="button simbols" \n          ng-click="$parent.simbol()"\n          navigable-leaf="simbol-button"\n          navigable-priority="1"\n          href>\n          <span>#$%</span>\n        </a>\n        <a class="button space" \n          ng-click="tap_space()"\n          navigable-leaf="space-button"\n          navigable-priority="2"\n          href>\n          <span>espacio</span>\n        </a>\n        <a class="button delete"\n          ng-click="container.content.remove_one()"\n          navigable-leaf="delete-button"\n          navigable-priority="3"\n          href>\n          <span>borrar</span>\n        </a>\n      </div>\n    </div>\n  </div>\n  \n  <div class="modal-footer">\n    <div class="modal-controls"\n      navigable-horizontal="keyboard controls"\n      navigable-priority="2">\n      <a class="modal-close" \n        navigable-priority="2"\n        navigable-leaf="confirm keyboard"\n        ng-click="confirm()"\n        href >\n        Aceptar\n      </a>\n      <a class="modal-resume"\n        navigable-priority="1"\n        navigable-leaf="resume keyboard"\n        ng-click="resume()"\n        href >\n        Cancelar\n      </a>\n      <a class="keyboard-next" \n        navigable-priority="0"\n        navigable-leaf="to t9 keyboard"\n        ng-click="container.to_t9()"\n        href >\n        Teclado T9\n      </a>\n    </div>\n  </div>\n</div>'),a.put("qwerty.simple.html",'<a class="button key-button" \n  ng-click="tap_special(button)"\n  navigable-leaf="button simple"\n  href>\n  <div ng-hide="has_simbol">\n    {{button.content}}\n  </div>\n  <div ng-show="has_simbol">\n    {{button.special}}\n  </div>\n</a>\n'),a.put("qwerty.special.html",'<a class="button key-button-special" \n  ng-click="tap_special(button)"\n  navigable-leaf="button special"\n  navigable-leaf-active="$index==0"\n  href>\n  <div ng-hide="has_simbol">\n    {{button.content}}\n  </div>\n  <div ng-show="has_simbol">\n    {{button.special}}\n  </div>\n</a>')}]),function(){"use strict";angular.module("module.tac.keyboard").controller("tac.keyboard.t9",["$scope","$modalInstance","$timeout","tac.keys","tac.keyboard.content","tac.keyboard.t9.buttons","tac.keyboard.t9.options","container",function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r;return a.assets=h.assets,e.process(h),r=800,l=function(){return $("#delay-bar")},a.buttons=f,a.options=g,a.back_btn={},a.menu_btn={},a.mode=p={},n={time:(new Date).getTime(),button:!1},j=function(){return l().width("100%"),j.animate=!0,l().animate({width:"0%"},r)},j.stop=function(){return j.animate?(l().stop(),l().width("0%"),j.animate=!1):void 0},o=function(a){return n.time=(new Date).getTime(),n.button=a},q=function(a){return n.button===a&&(new Date).getTime()-n.time<r},m=function(a){var b,c,d,e;for(c=String(a),d=0,e=f.length;e>d;d++)if(b=f[d],b.key===c)return b;return console.log("sin boton para "+a)},i=function(b){return b.klass="pressed",a.$apply(),c(function(){return b.klass="",a.$apply()},200)},k={handlers:{right:function(){return h.content.right(),a.$apply()},left:function(){return h.content.left(),a.$apply()},menu:function(){return k.to_menu_mode(),i(a.menu_btn)},anterior:function(a){return i(m(a.key)),h.content.remove_one()},go_back:function(b){return k.prev(),i(a.back_btn)},enter:function(a){return b.close()}},handle_button:function(a){var b;return b=m(a),q(b)?(b.times+=1,k.current.relapse(b)):(k.current.once(b),b.times=0),i(b),o(b)},zero:function(){var a;return a=m(0),"numbers"===this.current.mode?write("0"):write(" "),i(a),!0},one:function(){return i(m(1)),this.next()},handle:function(a){var b;return j.stop(),a.is_number?p.menu&&this.menu.handle(a.number)||0===a.number&&this.zero()||1===a.number&&this.one()||this.handle_button(a.number):(b=this.handlers[a.key],b&&b(a))},next:function(){return this.current_index+1<this.states.length?(this.set_state(this.current_index+1),!0):!1},prev:function(){return this.current===this.menu?this.set_state(this.current_index):this.current_index>0?this.set_state(this.current_index-1):b.close(),!0},set_state:function(a){return p[this.current.mode]=!1,this.current_index=a,this.current=this.states[this.current_index],p[this.current.mode]=!0},initialize:function(){return this.current_index=0,this.current=this.states[this.current_index],p[this.current.mode]=!0},menu:{mode:"menu",handle:function(c){switch(c){case 1:h.to_qwerty();break;case 2:h.content.erase(),k.prev(),a.$apply();break;case 3:b.dismiss()}return!0}},to_menu_mode:function(){return p[this.current.mode]=!1,this.current=this.menu,p[this.current.mode]=!0},states:[{mode:"letters",once:function(a){return h.content.write(a.letters.charAt(0)),j()},relapse:function(a){var b;return b=a.times%a.letters.length,h.content.rewrite(a.letters.charAt(b)),j()}},{mode:"mayusc",once:function(a){return h.content.write(a.mayusc.charAt(0)),j()},relapse:function(a){var b;return b=a.times%a.mayusc.length,h.content.rewrite(a.mayusc.charAt(b)),j()}},{mode:"symbol",once:function(a){return h.content.write(a.symbol.charAt(0)),j()},relapse:function(a){var b;return b=a.times%a.symbol.length,h.content.rewrite(a.symbol.charAt(b)),j()}},{mode:"numbers",once:function(a){return h.content.write(a.number)},relapse:function(a){return this.once(a)}}]},k.handlers["delete"]=k.handlers.letter=k.handlers.alt_gr=k.handlers.shift=function(a,b){return h.to_qwerty()},k.initialize(),h.content.sanitize(),b.result["finally"](function(){return d.unsubscribe(k)}),d.subscribe(k),a.container=h,a.controller=k}]).factory("tac.keyboard.t9.buttons",[function(){var a;return a=function(a,b,c,d,e){return{key:a,number:b||"",letters:c||"",mayusc:d||"",symbol:e||""}},[a("1","1"),a("2","2","abc","ABC",".:$"),a("3","3","def","DEF",",;("),a("4","4","ghi","GHI","@*["),a("5","5","jkl","JKL","-+{"),a("6","6","mnño","MNÑO","?¿)"),a("7","7","pqrs","PQRS","!¡]"),a("8","8","tuv","TUV","/=}"),a("9","9","wxyz","WXYZ","#_&"),a("epg"),a("0","0","_","_","_"),{key:"anterior",name:"<[X]",svg:"backspace"}]}]).factory("tac.keyboard.t9.options",[function(){return[{key:"1",description:"Cambiar a teclado querty"},{key:"2",description:"Borrar texto"},{key:"3",description:"Cancelar edicion"}]}])}.call(this),angular.module("module.tac.keyboard").run(["$templateCache",function(a){"use strict";a.put("t9.html",'<div>\n  <div class="modal-body" >\n    <div class="main-frame" >\n      <div class="input-frame" keyboard-input id="input-frame">\n       <div class="input" >\n         <span ng-repeat="letter in container.content.before_letters"><span class="space" ng-if="letter.key==\' \'">_</span><span ng-if="letter.key!=\' \'">{{letter.key}}</span></span>\n       </div>\n       <div class="cursor" id="cursor"></div>\n       <div class="input">\n         <span ng-repeat="letter in container.content.after_letters"><span class="space" ng-if="letter.key==\' \'">_</span><span ng-if="letter.key!=\' \'">{{letter.key}}</span></span>\n       </div>\n      </div>\n      <div class="delay-frame">\n        <div class="delay-bar" id="delay-bar">\n        </div>\n      </div>\n      <div class="menu-frame">\n        <div class="menu" ng-class="{\'disable\':mode.menu}">\n          <a class="menu-btn" ng-class="menu_btn.klass" ng-click="controller.to_menu_mode()" href>\n            menu\n          </a>\n        </div>\n      </div>\n      <div class="go-back-frame">\n        <div class="go-back">\n          <a class="go-back-btn" ng-click="controller.prev()" ng-class="back_btn.klass" href>\n            volver\n          </a>\n        </div>\n        <div class="go-back-description">\n          <span ng-hide="!mode.letters">\n            Cerrar teclado\n          </span>\n          <span ng-show="mode.mayusc">\n            Volver a modo minuscula\n          </span>\n          <span ng-show="mode.symbol">\n            Volver a modo texto\n          </span>\n          <span ng-show="mode.numbers">\n            Volver a modo simbolos\n          </span>\n          <span ng-show="mode.menu">\n            Ocultar opciones\n          </span>\n        </div>\n      </div>\n      <div class="buttons-frame" ng-hide="mode.menu">\n        <div ng-hide="mode.numbers" ng-click="controller.next()" class="modes" href>\n          <a class="mode letters" ng-class="{\'selected\':mode.letters}">\n            abc\n          </a>\n          <a class="mode mayusc" ng-class="{\'selected\':mode.mayusc}">\n            ABC\n          </a>\n          <a class="mode symbol" ng-class="{\'selected\':mode.symbol}">\n            @.?,\n          </a>\n          <a class="mode numbers">\n            123\n          </a>\n        </div>\n        <a ng-show="mode.numbers" class="button" ng-class="buttons[0].klass" href>\n          {{buttons[0].key}}\n        </a>\n        <div ng-repeat="button in buttons" ng-show="$index!=0">\n          <a class="button" ng-class="button.klass" href>\n            <div ng-if="button.svg" class="svg-button" inline-svg-model="{{assets}}/t9/{{button.svg}}.svg"></div>\n            <div ng-if="!button.svg" ng-show="button.name">\n              {{button.name}}\n            </div>\n            <div ng-if="!button.svg" ng-show="!button.name">\n              <div ng-hide="!mode.letters">\n                {{button.letters}}\n              </div>\n              <div ng-show="mode.mayusc">\n                {{button.mayusc}}\n              </div>\n              <div ng-show="mode.symbol">\n                <span class="symbol" ng-repeat="symbol in button.symbol">\n                  {{symbol}}\n                </span>\n              </div>\n              <div ng-show="mode.numbers">\n                {{button.number}}\n              </div>\n            </div>\n          </a>\n        </div>\n      </div>\n      <div class="options-frame" ng-show="mode.menu">\n        <a ng-repeat="option in options" class="option" ng-class="option.klass" href>\n          <div class="option-key">\n            {{option.key}}\n          </div>\n          <div class="option-description">\n            {{option.description}}\n          </div>\n        </a>\n      </div>\n    </div>\n  </div>\n</div>')}]);